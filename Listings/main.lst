C51 COMPILER V9.60.7.0   MAIN                                                              01/29/2026 21:06:12 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE src\main.c OPTIMIZE(9,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\
                    -main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REG52.H>
   2          
   3          
   4          // Local Headers
   5          #include "types.h"
   6          #include "helpers.h"
   7          #include "config.h"
   8          #include "hardware.h"
   9          #include "bitboard.h"
  10          #include "uart.h"
  11          #include "shift_registers.h"
  12          #include "tm_ssd.h"
  13          #include "interrupts.h"
  14          #include "move_gen.h"
  15              
  16              
  17          #define CLEAR_LEDS() set_leds(&ZeroBoard)
  18              
  19          bit JustEnteredState = 1;
  20          U8 CurrentMainState = TURNED_ON;
  21          U8 CurrentDetectionState = NONE;
  22          
  23          U8 ErrorFlashCount = 0;
  24          
  25          U8 DelayCounter = 0;
  26          
  27          int main(void) {
  28   1        
  29   1        uart_init();
  30   1        init_shift_reg();
  31   1        CLEAR_LEDS();
  32   1        
  33   1        TURN = WHITE;
  34   1        
  35   1        DelayCounter = 10;
  36   1        while (1) {
  37   2          
  38   2          if (rxPacketReady) process_rx_packet();
  39   2          if (txPacketReady) process_tx_packet();
  40   2          
  41   2          if (MOVE_RECEIVED) {
  42   3            
  43   3            EA = 0;  // Disable interrupts
  44   3            MOVE_RECEIVED = 0;
  45   3            EA = 1;  // Re-enable
  46   3            tm_display_digits(MoveSquares[1] + 9 + 1, MoveSquares[0] + 1, MoveSquares[3] + 9 + 1, MoveSquares[2] + 
             -1);
  47   3            CurrentMainState = AWAIT_MOVE_SET;
  48   3            JustEnteredState = 1;
  49   3          }
  50   2          
  51   2          
  52   2          if (DelayCounter > 0) DelayCounter--;
  53   2          switch (CurrentMainState) {
C51 COMPILER V9.60.7.0   MAIN                                                              01/29/2026 21:06:12 PAGE 2   

  54   3            
  55   3            case TURNED_ON:
  56   3              if (JustEnteredState) {
  57   4                tm_display_digits(1, 2, 2, 1);
  58   4                JustEnteredState = 0;
  59   4                set_leds(&OneBoard);
  60   4              }
  61   3              
  62   3              if (CONNECTED) {
  63   4                JustEnteredState = 1;
  64   4                DelayCounter = 10;
  65   4                CurrentMainState = AWAIT_INITIAL_POSITION_SET;
  66   4              }
  67   3              break;
  68   3              
  69   3            // AWAIT_INITIAL_POSITION_SET STATE MANAGEMENT
  70   3            case AWAIT_INITIAL_POSITION_SET:
  71   3              
  72   3              if (JustEnteredState){
  73   4                tm_display_digits(2, 3, 3, 2);
  74   4                if (LED_READY) {
  75   5                  JustEnteredState = 0;
  76   5                  LED_READY = 0;
  77   5                  CurrentBoard = DisplayBoardLEDs;
  78   5                  set_leds(&DisplayBoardLEDs);
  79   5                  DelayCounter = 2;
  80   5                }
  81   4                  break;
  82   4              }
  83   3              
  84   3              if (DelayCounter != 0) break;
  85   3      
  86   3              if (!read_and_verify_sensors()) {
  87   4                DelayCounter = 2;
  88   4                break;
  89   4              }
  90   3              MATCH = compare_boards(&CurrentBoard, &PolledBoard); 
  91   3              
  92   3              if (!MATCH) {
  93   4                DelayCounter = 2;
  94   4                break;
  95   4              }
  96   3              
  97   3              JustEnteredState = 1;
  98   3              CurrentMainState = DETECTING;
  99   3              break;
 100   3              
 101   3              
 102   3            case AWAIT_MOVE_SET:
 103   3              if (JustEnteredState) {
 104   4                  JustEnteredState = 0;
 105   4                  set_leds(&DisplayBoardLEDs);
 106   4                  DelayCounter = 2;
 107   4                  break;
 108   4              }
 109   3              
 110   3              if (DelayCounter != 0) break;
 111   3              
 112   3              // Try to read sensors
 113   3              if (!read_and_verify_sensors()) {
 114   4                  DelayCounter = 2;
 115   4                  break;
C51 COMPILER V9.60.7.0   MAIN                                                              01/29/2026 21:06:12 PAGE 3   

 116   4              }
 117   3              
 118   3              // Check if board matches expected position
 119   3              MATCH = compare_boards(&MoveBoard, &PolledBoard);
 120   3              
 121   3              if (MATCH) {
 122   4                  // Move completed successfully!
 123   4                  U8 FromRank, FromFile, ToRank, ToFile;
 124   4                  
 125   4                  // Extract move coordinates from MoveSquares
 126   4                  // MoveSquares format: [FromRank, FromFile, ToRank, ToFile]
 127   4                  FromRank = MoveSquares[0];
 128   4                  FromFile = MoveSquares[1];
 129   4                  ToRank = MoveSquares[2];
 130   4                  ToFile = MoveSquares[3];
 131   4                  
 132   4                  // Update king position if king moved
 133   4                  if ((BoardState[(FromRank << SHIFT) | FromFile] & TYPE_MASK) == TYPE_KING) {
 134   5                      KingSquares[TURN] = (ToRank << SHIFT) | ToFile;
 135   5                  }
 136   4                  
 137   4                  // Update BoardState array
 138   4                  BoardState[(ToRank << SHIFT) | ToFile] = BoardState[(FromRank << SHIFT) | FromFile];
 139   4                  BoardState[(FromRank << SHIFT) | FromFile] = EMPTY;
 140   4                  
 141   4                  // Update CurrentBoard to new position
 142   4                  CurrentBoard = MoveBoard;
 143   4                  
 144   4                  // Toggle turn
 145   4                  TURN = !TURN;
 146   4                  
 147   4                  // Clear LEDs
 148   4                  CLEAR_LEDS();
 149   4                  
 150   4                  if (is_game_over()) {
 151   5                    CurrentMainState = GAME_IS_OVER;
 152   5                    JustEnteredState = 1;
 153   5                    break;
 154   5                  }
 155   4                  
 156   4                  // Back to detecting
 157   4                  CurrentMainState = DETECTING;
 158   4                  CurrentDetectionState = NONE;
 159   4                  JustEnteredState = 1;
 160   4                  
 161   4                  break;
 162   4              }
 163   3              
 164   3              // Board doesn't match yet - keep waiting
 165   3              DelayCounter = 2;
 166   3              break;
 167   3            
 168   3            // DETECTION STATE MANAGEMENT
 169   3            case DETECTING:
 170   3              if (JustEnteredState) {
 171   4                tm_display_digits(3, 4, 4, 3);
 172   4                JustEnteredState = 0;
 173   4                CLEAR_LEDS();
 174   4                DelayCounter = 2;
 175   4                
 176   4              }
 177   3              
C51 COMPILER V9.60.7.0   MAIN                                                              01/29/2026 21:06:12 PAGE 4   

 178   3              if (LED_READY) {
 179   4                LED_READY = 0;
 180   4                set_leds(&DisplayBoardLEDs);
 181   4                DelayCounter = 2;
 182   4              }
 183   3      
 184   3              if (DelayCounter != 0) break;
 185   3              
 186   3              if (!read_and_verify_sensors()) {
 187   4                    DelayCounter = 2;
 188   4                    break;
 189   4              }
 190   3                  
 191   3              MATCH = compare_boards(&CurrentBoard, &PolledBoard);
 192   3      
 193   3              if (!MATCH) {
 194   4                JustEnteredState = 1;
 195   4                CurrentMainState = CHANGE_DETECTED;
 196   4                break;
 197   4              }
 198   3              
 199   3              CLEAR_LEDS();
 200   3              switch (CurrentDetectionState) {
 201   4                case NONE:
 202   4                  break;
 203   4                  
 204   4                case LIFT:
 205   4                  // Check if piece returned to original square
 206   4                  get_left_entered(&CurrentBoard, &PolledBoard);
 207   4                  
 208   4                  if (get_bit_count(&LeftMask) == 0 && get_bit_count(&EnteredMask) == 0) {
 209   5                      // Boards match - piece was returned
 210   5                      U8 FromRank, FromFile;
 211   5                      
 212   5                      FromRank = LiftedPieceSquare >> SHIFT;
 213   5                      FromFile = LiftedPieceSquare & MASK;
 214   5      
 215   5                      
 216   5                      // Verify piece is back on original square
 217   5                      if ((PolledBoard.RANK[FromRank] >> FromFile) & 1) {
 218   6                          CurrentDetectionState = NONE;
 219   6                          LiftedPieceSquare = 0;
 220   6                          CLEAR_LEDS();
 221   6                      } else {
 222   6                          // Boards match but piece not on original square - ERROR
 223   6                          CurrentMainState = ERROR_FLASH_ON;
 224   6                          CurrentDetectionState = NONE;
 225   6                          CLEAR_LEGAL_MOVES();
 226   6                      }
 227   5                  }
 228   4                  break;
 229   4              }
 230   3              
 231   3              DelayCounter = 2;
 232   3              break;
 233   3              
 234   3            // CHANGE_DETECTED STATE MANAGEMENT 
 235   3            case CHANGE_DETECTED:
 236   3              if (JustEnteredState) JustEnteredState = 0;
 237   3                
 238   3                get_left_entered(&CurrentBoard, &PolledBoard);
 239   3                
C51 COMPILER V9.60.7.0   MAIN                                                              01/29/2026 21:06:12 PAGE 5   

 240   3                switch (CurrentDetectionState){
 241   4      
 242   4                  case NONE:
 243   4                    tm_display_digits(1, 1, 1, 1);
 244   4                    if (get_bit_count(&LeftMask) == 1 && get_bit_count(&EnteredMask) == 0) {
 245   5                      U8 row, col;
 246   5                      bit found;
 247   5                      found = 0;
 248   5                      
 249   5                      CurrentDetectionState = LIFT;
 250   5                      CurrentMainState = DETECTING;
 251   5                      JustEnteredState = 1;
 252   5                      for (row=0; row<BOARD_W; row++) {
 253   6                        if (found) break;
 254   6                        for (col=0; col<BOARD_W; col++) {
 255   7                          if ((LeftMask.RANK[row] >> col) & 1) {
 256   8                            get_legal_moves((row << SHIFT) | col, &LegalMoves, 0);
 257   8                            DisplayBoardLEDs = LegalMoves;
 258   8                            LiftedPieceSquare = (row << SHIFT) | col;
 259   8                            LED_READY = 1;
 260   8                            found = 1; 
 261   8                            break;
 262   8                          }
 263   7                        }
 264   6                      }
 265   5                      break;
 266   5                    }
 267   4                    // ADD LOGGING HERE
 268   4                    
 269   4                    CurrentMainState = ERROR_FLASH_ON;
 270   4                    break;
 271   4                    
 272   4                
 273   4                  case LIFT:
 274   4                    // Piece still lifted
 275   4                    if (get_bit_count(&LeftMask) == 1 && get_bit_count(&EnteredMask) == 0) {
 276   5                      CurrentMainState = DETECTING; 
 277   5                      break;
 278   5                      
 279   5                      // Capture in progress: removed opponent's piece while holding yours
 280   5                    } else if (get_bit_count(&LeftMask) == 2 && get_bit_count(&EnteredMask) == 0) {
 281   5                        bit valid_capture;
 282   5                        U8 i, j;
 283   5                        
 284   5                        valid_capture = 0;
 285   5                        
 286   5                        // Check if one of the left pieces is a legal capture square
 287   5                        for (i=0; i<BOARD_W; i++) {
 288   6                            for (j=0; j<BOARD_W; j++) {
 289   7                                if ((LeftMask.RANK[i] >> j) & 1) {
 290   8                                    // Skip the originally lifted piece
 291   8                                    if (((i<< SHIFT) | j) == ((LiftedPieceSquare >> SHIFT) | (LiftedPieceSquare & MASK))) conti
             -nue;
 292   8                                    
 293   8                                    // Check if this square is a legal capture
 294   8                                    if ((LegalMoves.RANK[i] >> j) & 1) {
 295   9                                        valid_capture = 1;
 296   9                                        break;
 297   9                                    }
 298   8                                }
 299   7                            }
 300   6                            if (valid_capture) break;
C51 COMPILER V9.60.7.0   MAIN                                                              01/29/2026 21:06:12 PAGE 6   

 301   6                        }
 302   5                        
 303   5                        if (!valid_capture) {
 304   6                            CurrentMainState = ERROR_FLASH_ON;
 305   6                            CurrentDetectionState = NONE;
 306   6                            CLEAR_LEGAL_MOVES();
 307   6                            break;
 308   6                        }
 309   5                        
 310   5                        // Valid capture - wait for piece to be placed
 311   5                        IntermediateBoard = PolledBoard;
 312   5                        CurrentDetectionState = CAPTURE_INTERMEDIATE;
 313   5                        CurrentMainState = DETECTING;
 314   5                        break;
 315   5                        
 316   5                    // Piece placed on new square, check if legal
 317   5                    } else if (get_bit_count(&LeftMask) == 1 && get_bit_count(&EnteredMask) == 1) {
 318   5                        bit legal;
 319   5                        U8 ToSquare;
 320   5                        U8 row, col;
 321   5                        
 322   5                        U8 FromRank, FromFile;
 323   5                        U8 ToRank, ToFile;
 324   5                        
 325   5                        ToSquare = 0;
 326   5                        legal = 0;
 327   5                        
 328   5                        for (row=0; row<BOARD_W; row++) {
 329   6                          if (EnteredMask.RANK[row] & LegalMoves.RANK[row]) {
 330   7                            for (col = 0; col<BOARD_W; col++) if ((EnteredMask.RANK[row] >> col) & 1) break;
 331   7                              ToSquare = (row << SHIFT) | col;
 332   7                              legal = 1;
 333   7                              break;
 334   7                          }
 335   6                        }
 336   5                        
 337   5                        if (!legal) {
 338   6                          CurrentMainState = ERROR_FLASH_ON;
 339   6                          CurrentDetectionState = NONE;
 340   6                          CLEAR_LEGAL_MOVES();
 341   6                          break;
 342   6                        }
 343   5                        
 344   5                        FromRank = LiftedPieceSquare >> SHIFT;
 345   5                        FromFile = LiftedPieceSquare & MASK;
 346   5                        
 347   5                        ToRank = ToSquare >> SHIFT;
 348   5                        ToFile = ToSquare & MASK;
 349   5                        
 350   5                        if ((BoardState[(FromRank << SHIFT) | FromFile] & TYPE_MASK) == TYPE_KING) {
 351   6                          KingSquares[TURN] = (ToRank << SHIFT) | ToFile;
 352   6                        }
 353   5                        
 354   5                        
 355   5                        BoardState[(ToRank << SHIFT) | ToFile] = BoardState[(FromRank << SHIFT) | FromFile];
 356   5                        BoardState[(FromRank << SHIFT) | FromFile] = EMPTY;
 357   5                        
 358   5                        CurrentBoard.RANK[FromRank] &= ~(1 << FromFile);
 359   5                        CurrentBoard.RANK[ToRank] |= 1 << ToFile;
 360   5                        
 361   5                        // Toggle turn
 362   5                        TURN = !TURN;
C51 COMPILER V9.60.7.0   MAIN                                                              01/29/2026 21:06:12 PAGE 7   

 363   5                        
 364   5                        CurrentDetectionState = NONE;
 365   5                        CurrentMainState = DETECTING;
 366   5                        CLEAR_LEGAL_MOVES();
 367   5                        
 368   5                        txHeader = HEADER;
 369   5                        txType = MOVE_PACKET;
 370   5                        txLen = 0x02;
 371   5                        
 372   5                        txBuffer[0] = LiftedPieceSquare;
 373   5                        txBuffer[1] = ToSquare;
 374   5                        
 375   5                        txPacketReady = 1;
 376   5                        
 377   5                        if (is_game_over()) {
 378   6                          CurrentMainState = GAME_IS_OVER;
 379   6                          JustEnteredState = 1;
 380   6                          break;
 381   6                        }
 382   5                        
 383   5                        break;
 384   5                      
 385   5                      
 386   5                    } else {
 387   5                        CurrentMainState = DETECTING; 
 388   5                      break;
 389   5                    }
 390   4                    
 391   4                    
 392   4                  case CAPTURE_INTERMEDIATE:
 393   4                    get_left_entered(&IntermediateBoard, &PolledBoard);
 394   4                    // Waiting for captured piece to be placed on new square
 395   4                    if (get_bit_count(&LeftMask) == 0 && get_bit_count(&EnteredMask) == 1) {
 396   5                        bit legal;
 397   5                        U8 ToSquare;
 398   5                        U8 FromRank, FromFile;
 399   5                        U8 ToRank, ToFile;
 400   5                        U8 CapturedRank, CapturedFile;
 401   5                        U8 i, j;
 402   5                        
 403   5                        legal = 0;
 404   5                        
 405   5                        // Find where piece was placed
 406   5                        for (i=0; i<BOARD_W; i++) {
 407   6                            if (EnteredMask.RANK[i] & LegalMoves.RANK[i]) {
 408   7                                for (j = 0; j<BOARD_W; j++) {
 409   8                                    if ((EnteredMask.RANK[i] >> j) & 1) {
 410   9                                        ToSquare = (i << SHIFT) | j;
 411   9                                        legal = 1;
 412   9                                        break;
 413   9                                    }
 414   8                                }
 415   7                                if (legal) break;
 416   7                            }
 417   6                        }
 418   5                        
 419   5                        if (!legal) {
 420   6                            CurrentMainState = ERROR_FLASH_ON;
 421   6                            CurrentDetectionState = NONE;
 422   6                            CLEAR_LEGAL_MOVES();
 423   6                            break;
 424   6                        }
C51 COMPILER V9.60.7.0   MAIN                                                              01/29/2026 21:06:12 PAGE 8   

 425   5                        
 426   5                        FromRank = LiftedPieceSquare >> SHIFT;
 427   5                        FromFile = LiftedPieceSquare & MASK;
 428   5                        
 429   5                        ToRank = ToSquare >> SHIFT;
 430   5                        ToFile = ToSquare & MASK;
 431   5                        
 432   5                        // Find captured piece square
 433   5                        for (i=0; i<BOARD_W; i++) {
 434   6                            for (j=0; j<BOARD_W; j++) {
 435   7                                if ((LeftMask.RANK[i] >> j) & 1) {
 436   8                                    if (((i<< SHIFT) | j) != ((FromRank << SHIFT) | FromFile)) {
 437   9                                        CapturedRank = i;
 438   9                                        CapturedFile = j;
 439   9                                        break;
 440   9                                    }
 441   8                                }
 442   7                            }
 443   6                        }
 444   5                        
 445   5                        // Update king position if king moved
 446   5                        if ((BoardState[(FromRank << SHIFT) | FromFile] & TYPE_MASK) == TYPE_KING) {
 447   6                            KingSquares[TURN] = (ToRank << SHIFT) | ToFile;
 448   6                        }
 449   5                        
 450   5                        // Update board state
 451   5                        BoardState[(ToRank << SHIFT) | ToFile] = BoardState[(FromRank << SHIFT) | FromFile];
 452   5                        BoardState[(FromRank << SHIFT) | FromFile] = EMPTY;
 453   5                        BoardState[(CapturedRank << SHIFT) | CapturedFile] = EMPTY;
 454   5                        
 455   5                        // Update current board bitboard
 456   5                        CurrentBoard.RANK[FromRank] &= ~(1 << FromFile);
 457   5                        CurrentBoard.RANK[CapturedRank] &= ~(1 << CapturedFile);
 458   5                        CurrentBoard.RANK[ToRank] |= 1 << ToFile;
 459   5                        
 460   5                        // Toggle turn
 461   5                        TURN = !TURN;
 462   5                        
 463   5                        CurrentDetectionState = NONE;
 464   5                        CurrentMainState = DETECTING;
 465   5                        CLEAR_LEGAL_MOVES();
 466   5                        
 467   5                        // Send move to host
 468   5                        txHeader = HEADER;
 469   5                        txType = MOVE_PACKET;
 470   5                        txLen = 0x02;
 471   5                        
 472   5                        txBuffer[0] = LiftedPieceSquare;
 473   5                        txBuffer[1] = ToSquare;
 474   5                        
 475   5                        txPacketReady = 1;
 476   5                        
 477   5                        if (is_game_over()) {
 478   6                          CurrentMainState = GAME_IS_OVER;
 479   6                          JustEnteredState = 1;
 480   6                          break;
 481   6                        }
 482   5                        
 483   5                        break;
 484   5                    }
 485   4                    
 486   4                    // Still in intermediate state
C51 COMPILER V9.60.7.0   MAIN                                                              01/29/2026 21:06:12 PAGE 9   

 487   4                    else if (get_bit_count(&LeftMask) == 0 && get_bit_count(&EnteredMask) == 0) {
 488   5                        CurrentMainState = DETECTING;
 489   5                        break;
 490   5                    }
 491   4                    
 492   4                    // Unexpected state
 493   4                    else {
 494   5                        CurrentMainState = ERROR_FLASH_ON;
 495   5                        CurrentDetectionState = NONE;
 496   5                        CLEAR_LEGAL_MOVES();
 497   5                        break;
 498   5                    }
 499   4                    
 500   4                    default:
 501   4                      // Should never reach here, but recover gracefully
 502   4                      CurrentMainState = ERROR_FLASH_ON;
 503   4                      CurrentDetectionState = NONE;
 504   4                      CLEAR_LEGAL_MOVES();
 505   4                      break;
 506   4                  }
 507   3            
 508   3              break;
 509   3              
 510   3            
 511   3            case GAME_IS_OVER:
 512   3              if (JustEnteredState) {
 513   4                Bitboard display_over;
 514   4                U8 square;
 515   4                
 516   4                JustEnteredState = 0;
 517   4                square = KingSquares[TURN];
 518   4                
 519   4                if (GAME_OVER_INFO == 1) {
 520   5                  display_over.RANK[0] = 0;
 521   5                  display_over.RANK[1] = 0;
 522   5                  display_over.RANK[2] = 0;
 523   5                  display_over.RANK[3] = 0;
 524   5                  display_over.RANK[4] = 0;
 525   5                  display_over.RANK[5] = 0;
 526   5                  display_over.RANK[6] = 0;
 527   5                  display_over.RANK[7] = 0;
 528   5                  display_over.RANK[square >> SHIFT] |= (1 << (square & MASK));
 529   5                } else if (GAME_OVER_INFO == 0) {
 530   5                  display_over.RANK[0] = 0xFF;
 531   5                  display_over.RANK[1] = 0xFF;
 532   5                  display_over.RANK[2] = 0xFF;
 533   5                  display_over.RANK[3] = 0xFF;
 534   5                  display_over.RANK[4] = 0xFF;
 535   5                  display_over.RANK[5] = 0xFF;
 536   5                  display_over.RANK[6] = 0xFF;
 537   5                  display_over.RANK[7] = 0xFF;
 538   5                  
 539   5                  display_over.RANK[square >> SHIFT] &= ~(1 << (square & MASK));
 540   5                }
 541   4                set_leds(&display_over);
 542   4              }
 543   3              break;
 544   3                      
 545   3                    
 546   3            case ERROR_FLASH_ON:
 547   3                if (JustEnteredState) {
 548   4                    JustEnteredState = 0;
C51 COMPILER V9.60.7.0   MAIN                                                              01/29/2026 21:06:12 PAGE 10  

 549   4                    set_leds(&OneBoard);  // All LEDs on = ERROR
 550   4                    ErrorFlashCount++;
 551   4                }
 552   3                
 553   3                if (DelayCounter != 0) break;
 554   3                
 555   3                if (ErrorFlashCount >= 6) {
 556   4                    ErrorFlashCount = 0;
 557   4                    
 558   4                    if (read_and_verify_sensors()) {
 559   5                        MATCH = compare_boards(&CurrentBoard, &PolledBoard);
 560   5                        
 561   5                        if (MATCH) {
 562   6                            // Board corrected!
 563   6                            CurrentMainState = DETECTING;
 564   6                            CurrentDetectionState = NONE;
 565   6                            CLEAR_LEDS();
 566   6                            JustEnteredState = 1;
 567   6                            DelayCounter = 10;
 568   6                            break;
 569   6                        }
 570   5                    }
 571   4                    
 572   4                    // Still wrong - show expected position
 573   4                    set_leds(&CurrentBoard);  // Show where pieces SHOULD be
 574   4                    DelayCounter = 50;  // Display for 500ms
 575   4                    ErrorFlashCount = 0;  // Reset to flash again
 576   4                    break;
 577   4                }
 578   3                
 579   3                CurrentMainState = ERROR_FLASH_OFF;
 580   3                DelayCounter = 10;
 581   3                JustEnteredState = 1;
 582   3                break;
 583   3      
 584   3            case ERROR_FLASH_OFF:
 585   3              if (JustEnteredState) {
 586   4                  JustEnteredState = 0;
 587   4                  CLEAR_LEDS();
 588   4              }
 589   3              
 590   3              if (DelayCounter != 0) break;
 591   3              CurrentMainState = ERROR_FLASH_ON;
 592   3              DelayCounter = 10;
 593   3              JustEnteredState = 1;
 594   3              break;
 595   3          
 596   3          
 597   3          }
 598   2          
 599   2          delay_ms(10);
 600   2        }
 601   1        
 602   1        //return 0;
 603   1      }
 604          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2013    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
C51 COMPILER V9.60.7.0   MAIN                                                              01/29/2026 21:06:12 PAGE 11  

   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4       9
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
